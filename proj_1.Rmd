---
title: 'Project 1: A Simulation Study to Compare Three Survival Models'
author: 'Group 2, UNI: jr3755, cz2544, xw2598'
date: "February 6, 2019"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(coxed)
library(survival)
library(quantreg)
library(glmnet)
library(MASS)
library(pROC)
set.seed(8160201902)
```

from syllabus: 

Each report should include (1) A description of the statistical problem to be addressed; (2) A general description of the approach taken, along with some justication for the direction taken;(3) Conclusions, along with supporting output (typically including graphics); (4) The complete code.

project requirement:

Your tasks: Design a simulation study to evaluate the impacts of misspecifying the baseline hazard function
on the estimate of the treatment effect, and one could avoid this issue by using a semi-parametric Cox model.
In the meantime, investigate the impact of fitting too complicated a model when an exponential is sufficient

published studies:
The simulation study would include data simulated under various distributions such as exponential, Weibull, log-normal, log-logistic and with different sample sizes and effect sizes, to evaluate power, type I error rate and precision of the estimated coefficient.


========================
#Start here:


**1. Objectives:**
1.1 Design a simulation study to evaluate the impacts of misspecifying the baseline hazard function
on the estimate of the treatment effect, and one could avoid this issue by using a semi-parametric Cox model.

\begin{table}[ht]
\caption{impacts of misspecifying the baseline hazard function}
\begin{center}
\begin{tabular}{|l|c|}
\hline
baseline hazard function & fit model & estimator \\[1mm]\hline

\text  exponential proportional-hazards baseline & exponential proportional-hazards model\\[2mm]
\text     &Weibull proportional-hazards model \\[2mm]
\text     &Cox proportional-hazards model\\[2mm]
\text  Weibull proportional-hazards baseline  & exponential proportional-hazards model\\[2mm]
\text     & Weibull proportional-hazards model\\[2mm]
\textbf   & Cox proportional-hazards model \\
\hline
\end{tabular}
\end{center}
\label{default}
\end{table}

1.2 Investigate the impact of fitting too complicated a model when an exponential is sufficient
begin{table}[ht]
\caption{impact of fitting a too complicated model}
\begin{center}
\begin{tabular}{|l|c|}
\hline
baseline hazard function & fit model & estimator & power & bias \\[1mm]\hline

\text  exponential proportional-hazards baseline & exponential proportional-hazards model &  & \\[2mm]
\text     &Weibull proportional-hazards model &  & \\[2mm]
\text     &Cox proportional-hazards model &  & \\[2mm]
\text  Weibull proportional-hazards baseline  & exponential proportional-hazards model &  & \\[2mm]
\text     & Weibull proportional-hazards model &   & \\[2mm]
\textbf   & Cox proportional-hazards model &   & \\
\hline
\end{tabular}
\end{center}
\label{default}
\end{table}

**2. Statistical methods to be studied:**
3 Proportional hazards models: An exponential proportional-hazards model,A Weibull proportional-hazards model, A Cox proportional-hazards model.


**3. Scenarios to be investigated:**
Simulation studies usually examine the properties of one or more statistical methods in several
scenarios defined by values of various factors such as sample size and proportion of censoring.

**4. Methods for generating data:**
(. Simulation procedures
a. Level of dependence between simulated datasets
b. Allowance for failures
c . Software to perform simulations
d. Random number generator to use 
e . Specification of the starting seeds)

4.1 The relationship between the generated samples:
4.2 The rationale for any choices made regarding the distributions of the data,
parameters of any statistical models and the covariate correlation structure used to generate the
data set should accompany their specifications. The generated data should be verified to ensure
they resemble what is being simulated, for example using summary measures for the covariate
distributions, Kaplan–Meier survival curves for survival data or fitting appropriate regression
models.

**5. Performance measures:**
Assessment of bias
Assessment of accuracy
Power, type I and II errors
Assessment of coverage


**6. Simulation results:**(Estimates to be stored for each simulation and summary
 measures to be calculated over all simulations )
 6.1 distribution of simulated data
 6.2 survival plot of simulated data in different model
 6.3 measurement results from different model (estimates, bias, accuracy, power, alpha, beta)
 

**7. Conclusions:**
(Number of simulations to be performed, Criteria to evaluate the performance of statistical methods for different
 scenarios
)

**8. Presentation of the simulation results **

**9. Discussions:**
censoring

**10. References**
1. Statist. Med. 2006; 25:4279–4292, A. BURTON ET AL. DOI: 10.1002/sim.2673


#step 1. generate data
1.1 derivation of the t fomular (Ren):

n
miu
randome error

1) decay rate miu = 1
2) decay rate miu = 2
3) decay rate miu = 0.5

1.2 plot to confirm good randomnes

plot1
plot2
plot2

#step 2. fit different data into different model and get estimation points

1) Exponential
2) Weibull
3) Cox

test goodness of fit for different model,

estimation perfomance: invaraince(sample size), accuracy(bias vs variance)
plots/table:

AIC
CI and p-Value

same simulation dataset in different models survplots,

Effect of frailty

### R codes for Hazard Ratio Estimation
```{r, eval=F, echo=T}
# Exponential
fit.exponential <- survreg(Surv(y) ~ x[, 1] + x[, 2], dist = "exponential")
summary(fit.exponential)
- fit.exponential$coefficients[-1]

# Weibull
fit.weibull <- survreg(Surv(y) ~ x[, 1] + x[, 2], dist = "weibull")
summary(fit.weibull)
- fit.weibull$coefficients[-1] / fit.weibull$scale

# Cox
fit.cox <- coxph(Surv(y) ~ x[, 1] + x[, 2])
summary(fit.cox)
```


